[2024-07-01T20:06:53.716-0400] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-01T20:06:53.740-0400] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: api_cuevana3_movie.execute_post_details_fasapi scheduled__2024-07-01T07:00:00+00:00 [queued]>
[2024-07-01T20:06:53.758-0400] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: api_cuevana3_movie.execute_post_details_fasapi scheduled__2024-07-01T07:00:00+00:00 [queued]>
[2024-07-01T20:06:53.758-0400] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-01T20:06:53.790-0400] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): execute_post_details_fasapi> on 2024-07-01 07:00:00+00:00
[2024-07-01T20:06:53.803-0400] {standard_task_runner.py:63} INFO - Started process 413632 to run task
[2024-07-01T20:06:53.810-0400] {standard_task_runner.py:90} INFO - Running: ['airflow', 'tasks', 'run', 'api_cuevana3_movie', 'execute_post_details_fasapi', 'scheduled__2024-07-01T07:00:00+00:00', '--job-id', '711', '--raw', '--subdir', 'DAGS_FOLDER/movie_recommend.py', '--cfg-path', '/tmp/tmp8evxgxfd']
[2024-07-01T20:06:53.813-0400] {standard_task_runner.py:91} INFO - Job 711: Subtask execute_post_details_fasapi
[2024-07-01T20:06:53.873-0400] {task_command.py:426} INFO - Running <TaskInstance: api_cuevana3_movie.execute_post_details_fasapi scheduled__2024-07-01T07:00:00+00:00 [running]> on host walter-VirtualBox
[2024-07-01T20:06:54.065-0400] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='airflow' AIRFLOW_CTX_DAG_ID='api_cuevana3_movie' AIRFLOW_CTX_TASK_ID='execute_post_details_fasapi' AIRFLOW_CTX_EXECUTION_DATE='2024-07-01T07:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-07-01T07:00:00+00:00'
[2024-07-01T20:06:54.066-0400] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-01T20:06:54.090-0400] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-01T20:06:54.090-0400] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/walter/Documentos/rakuntentv/venv/lib/python3.12/site-packages/urllib3/connection.py", line 196, in _new_conn
    sock = connection.create_connection(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/walter/Documentos/rakuntentv/venv/lib/python3.12/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/home/walter/Documentos/rakuntentv/venv/lib/python3.12/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/walter/Documentos/rakuntentv/venv/lib/python3.12/site-packages/urllib3/connectionpool.py", line 789, in urlopen
    response = self._make_request(
               ^^^^^^^^^^^^^^^^^^^
  File "/home/walter/Documentos/rakuntentv/venv/lib/python3.12/site-packages/urllib3/connectionpool.py", line 495, in _make_request
    conn.request(
  File "/home/walter/Documentos/rakuntentv/venv/lib/python3.12/site-packages/urllib3/connection.py", line 398, in request
    self.endheaders()
  File "/usr/lib/python3.12/http/client.py", line 1331, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "/usr/lib/python3.12/http/client.py", line 1091, in _send_output
    self.send(msg)
  File "/usr/lib/python3.12/http/client.py", line 1035, in send
    self.connect()
  File "/home/walter/Documentos/rakuntentv/venv/lib/python3.12/site-packages/urllib3/connection.py", line 236, in connect
    self.sock = self._new_conn()
                ^^^^^^^^^^^^^^^^
  File "/home/walter/Documentos/rakuntentv/venv/lib/python3.12/site-packages/urllib3/connection.py", line 211, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x704b776cc8c0>: Failed to establish a new connection: [Errno 111] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/walter/Documentos/rakuntentv/venv/lib/python3.12/site-packages/requests/adapters.py", line 667, in send
    resp = conn.urlopen(
           ^^^^^^^^^^^^^
  File "/home/walter/Documentos/rakuntentv/venv/lib/python3.12/site-packages/urllib3/connectionpool.py", line 843, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "/home/walter/Documentos/rakuntentv/venv/lib/python3.12/site-packages/urllib3/util/retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=8000): Max retries exceeded with url: /scraper-movies-details (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x704b776cc8c0>: Failed to establish a new connection: [Errno 111] Connection refused'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/walter/Documentos/rakuntentv/airflow/dags/movie_recommend.py", line 58, in execute_post_details_fasapi
    response = requests.post(api_url)
               ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/walter/Documentos/rakuntentv/venv/lib/python3.12/site-packages/requests/api.py", line 115, in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/walter/Documentos/rakuntentv/venv/lib/python3.12/site-packages/requests/api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/walter/Documentos/rakuntentv/venv/lib/python3.12/site-packages/requests/sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/walter/Documentos/rakuntentv/venv/lib/python3.12/site-packages/requests/sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/walter/Documentos/rakuntentv/venv/lib/python3.12/site-packages/requests/adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='localhost', port=8000): Max retries exceeded with url: /scraper-movies-details (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x704b776cc8c0>: Failed to establish a new connection: [Errno 111] Connection refused'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/walter/Documentos/rakuntentv/venv/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/walter/Documentos/rakuntentv/venv/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/walter/Documentos/rakuntentv/venv/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/walter/Documentos/rakuntentv/venv/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/walter/Documentos/rakuntentv/venv/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/walter/Documentos/rakuntentv/airflow/dags/movie_recommend.py", line 83, in execute_post_details_fasapi
    consumer.close()
    ^^^^^^^^
UnboundLocalError: cannot access local variable 'consumer' where it is not associated with a value
[2024-07-01T20:06:54.098-0400] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=api_cuevana3_movie, task_id=execute_post_details_fasapi, run_id=scheduled__2024-07-01T07:00:00+00:00, execution_date=20240701T070000, start_date=20240702T000653, end_date=20240702T000654
[2024-07-01T20:06:54.130-0400] {standard_task_runner.py:110} ERROR - Failed to execute job 711 for task execute_post_details_fasapi (cannot access local variable 'consumer' where it is not associated with a value; 413632)
[2024-07-01T20:06:54.164-0400] {local_task_job_runner.py:240} INFO - Task exited with return code 1
[2024-07-01T20:06:54.183-0400] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-01T20:06:54.239-0400] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-01T23:11:42.027-0400] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-01T23:11:42.040-0400] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: api_cuevana3_movie.execute_post_details_fasapi scheduled__2024-07-01T07:00:00+00:00 [queued]>
[2024-07-01T23:11:42.044-0400] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: api_cuevana3_movie.execute_post_details_fasapi scheduled__2024-07-01T07:00:00+00:00 [queued]>
[2024-07-01T23:11:42.044-0400] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-01T23:11:42.057-0400] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): execute_post_details_fasapi> on 2024-07-01 07:00:00+00:00
[2024-07-01T23:11:42.063-0400] {standard_task_runner.py:63} INFO - Started process 447416 to run task
[2024-07-01T23:11:42.066-0400] {standard_task_runner.py:90} INFO - Running: ['airflow', 'tasks', 'run', 'api_cuevana3_movie', 'execute_post_details_fasapi', 'scheduled__2024-07-01T07:00:00+00:00', '--job-id', '837', '--raw', '--subdir', 'DAGS_FOLDER/movie_recommend.py', '--cfg-path', '/tmp/tmp87_1oakq']
[2024-07-01T23:11:42.072-0400] {standard_task_runner.py:91} INFO - Job 837: Subtask execute_post_details_fasapi
[2024-07-01T23:11:42.110-0400] {task_command.py:426} INFO - Running <TaskInstance: api_cuevana3_movie.execute_post_details_fasapi scheduled__2024-07-01T07:00:00+00:00 [running]> on host walter-VirtualBox
[2024-07-01T23:11:42.184-0400] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='airflow' AIRFLOW_CTX_DAG_ID='api_cuevana3_movie' AIRFLOW_CTX_TASK_ID='execute_post_details_fasapi' AIRFLOW_CTX_EXECUTION_DATE='2024-07-01T07:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-07-01T07:00:00+00:00'
[2024-07-01T23:11:42.185-0400] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-01T23:12:36.345-0400] {logging_mixin.py:188} INFO - Scraping movie details running successfully
[2024-07-01T23:12:36.390-0400] {logging_mixin.py:188} INFO - {"image_url": "https://i0.wp.com/www.themoviedb.org/t/p/w185/6BcxgP05jDip4Zjh2P5Be2aNi0Z.jpg", "title": "Gru 4. Mi villano favorito", "rating": 8.6, "duration": "1h 35m", "year": "2024", "quality": "HD", "description": "Ver gru 4. mi villano favorito Cuevana3.Gru, Lucy y las ni\u00f1as -Margo, Edith y Agnes- dan la bienvenida a un nuevo miembro en la familia: Gru Junior, que parece llegar con el prop\u00f3sito de ser un suplicio para su padre. Gru tendr\u00e1 que enfrentarse en esta ocasi\u00f3n a su nueva n\u00e9mesis Maxime Le Mal y su sofisticada y mal\u00e9vola novia Valentina, lo que obligar\u00e1 a la familia a tener que darse a la fuga. Cuarta entrega de 'Gru, mi villano favorito'.", "genre": ["Animaci\u00f3n", "Familia", "Comedia", "Acci\u00f3n"], "country": "United States", "director": "Chris Renaud", "actors": ["Steve Carell,", "Kristen Wiig,", "Will Ferrell,", "Sof\u00eda Vergara,", "Joey King,", "Stephen Colbert,", "Chloe Fineman,", "Miranda Cosgrove,", "Dana Gaier,", "Madison Polan,", "Pierre Coffin,", "Steve Coogan,", "Chris Renaud,", "Jason Segel,", "Benjamin Bratt,", "Trey Parker,", "Sandra Bullock,", "Jon Hamm,", "Taraji P. Henson,", "Russell Brand,"], "views": 65}
[2024-07-01T23:12:36.412-0400] {python.py:237} INFO - Done. Returned value was: {"image_url": "https://i0.wp.com/www.themoviedb.org/t/p/w185/6BcxgP05jDip4Zjh2P5Be2aNi0Z.jpg", "title": "Gru 4. Mi villano favorito", "rating": 8.6, "duration": "1h 35m", "year": "2024", "quality": "HD", "description": "Ver gru 4. mi villano favorito Cuevana3.Gru, Lucy y las ni\u00f1as -Margo, Edith y Agnes- dan la bienvenida a un nuevo miembro en la familia: Gru Junior, que parece llegar con el prop\u00f3sito de ser un suplicio para su padre. Gru tendr\u00e1 que enfrentarse en esta ocasi\u00f3n a su nueva n\u00e9mesis Maxime Le Mal y su sofisticada y mal\u00e9vola novia Valentina, lo que obligar\u00e1 a la familia a tener que darse a la fuga. Cuarta entrega de 'Gru, mi villano favorito'.", "genre": ["Animaci\u00f3n", "Familia", "Comedia", "Acci\u00f3n"], "country": "United States", "director": "Chris Renaud", "actors": ["Steve Carell,", "Kristen Wiig,", "Will Ferrell,", "Sof\u00eda Vergara,", "Joey King,", "Stephen Colbert,", "Chloe Fineman,", "Miranda Cosgrove,", "Dana Gaier,", "Madison Polan,", "Pierre Coffin,", "Steve Coogan,", "Chris Renaud,", "Jason Segel,", "Benjamin Bratt,", "Trey Parker,", "Sandra Bullock,", "Jon Hamm,", "Taraji P. Henson,", "Russell Brand,"], "views": 65}
[2024-07-01T23:12:36.413-0400] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-01T23:12:36.443-0400] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=api_cuevana3_movie, task_id=execute_post_details_fasapi, run_id=scheduled__2024-07-01T07:00:00+00:00, execution_date=20240701T070000, start_date=20240702T031142, end_date=20240702T031236
[2024-07-01T23:12:36.495-0400] {local_task_job_runner.py:240} INFO - Task exited with return code 0
[2024-07-01T23:12:36.517-0400] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-01T23:12:36.520-0400] {local_task_job_runner.py:222} INFO - ::endgroup::
